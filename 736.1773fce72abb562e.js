"use strict";(self.webpackChunkmy_ng3=self.webpackChunkmy_ng3||[]).push([[736],{736:(ye,G,l)=>{l.r(G),l.d(G,{GoogleModule:()=>ve});var g=l(9808),f=l(4354),e=l(7587),v=l(3900),m=l(9646),h=l(4004),T=l(1341),L=l(1135),q=l(4671),I=l(4482),P=l(5403);function J(n,r){return n===r}var O=l(2076),R=l(7579),M=l(6063);class N extends R.x{constructor(r=1/0,t=1/0,o=M.l){super(),this._bufferSize=r,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,r),this._windowTime=Math.max(1,t)}next(r){const{isStopped:t,_buffer:o,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:a}=this;t||(o.push(r),!i&&o.push(s.now()+a)),this._trimBuffer(),super.next(r)}_subscribe(r){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(r),{_infiniteTimeWindow:o,_buffer:i}=this,s=i.slice();for(let a=0;a<s.length&&!r.closed;a+=o?1:2)r.next(s[a]);return this._checkFinalizedStatuses(r),t}_trimBuffer(){const{_bufferSize:r,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:i}=this,s=(i?1:2)*r;if(r<1/0&&s<o.length&&o.splice(0,o.length-s),!i){const a=t.now();let u=0;for(let p=1;p<o.length&&o[p]<=a;p+=2)u=p;u&&o.splice(0,u+1)}}}var $=l(3099),A=l(262);function b(n,r,t,o,i,s,a){try{var u=n[s](a),p=u.value}catch(Te){return void t(Te)}u.done?r(p):Promise.resolve(p).then(o,i)}function z(n){return function(){var r=this,t=arguments;return new Promise(function(o,i){var s=n.apply(r,t);function a(p){b(s,o,i,a,u,"next",p)}function u(p){b(s,o,i,a,u,"throw",p)}a(void 0)})}}function S(n){const r=new Uint32Array(n/2);return crypto.getRandomValues(r),Array.from(r,t=>("0"+t.toString(16)).slice(-2)).join("")}function C(){return(C=z(function*(n){const t=(new TextEncoder).encode(n);return crypto.subtle.digest("SHA-256",t)})).apply(this,arguments)}var Z=l(520);const _="google-token",k="google-code-verifier",w="google-security-token",E="https://oauth2.googleapis.com/token";let y=(()=>{class n{constructor(t,o,i){this.configuration=t,this.http=o,this.router=i,this.tokenReadySubject=new L.X(null),this.tokenData=null,this.tokenReady$=this.tokenReadySubject.asObservable().pipe(function F(n,r=q.y){return n=null!=n?n:J,(0,I.e)((t,o)=>{let i,s=!0;t.subscribe(new P.Q(o,a=>{const u=r(a);(s||!n(i,u))&&(s=!1,i=u,o.next(a))}))})}());const s=localStorage.getItem(_);s&&(this.tokenData=JSON.parse(s)),this.codeVerifier=S(56),this.codeChallenge$=(0,O.D)(function Q(n){return C.apply(this,arguments)}(this.codeVerifier)).pipe((0,h.U)(a=>function D(n){return function j(n){let r="",t=new Uint8Array(n),o=t.byteLength;for(var i=0;i<o;i++)r+=String.fromCharCode(t[i]);return btoa(r)}(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(a)),function Y(n,r,t){var o,i;let s,a=!1;return n&&"object"==typeof n?(s=null!==(o=n.bufferSize)&&void 0!==o?o:1/0,r=null!==(i=n.windowTime)&&void 0!==i?i:1/0,a=!!n.refCount,t=n.scheduler):s=null!=n?n:1/0,(0,$.B)({connector:()=>new N(s,r,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}(1)),this.getAccessToken().subscribe(()=>this.emmitTokenReadyEvent())}emmitTokenReadyEvent(){this.tokenReadySubject.next(!!this.tokenData)}setTokenData(t){var o;return null===t?localStorage.removeItem(_):(!t.refresh_token&&(null===(o=this.tokenData)||void 0===o?void 0:o.refresh_token)&&(t.refresh_token=this.tokenData.refresh_token),t.expires||(t.expires=(new Date).getTime()+1e3*(t.expires_in-10)),localStorage.setItem(_,JSON.stringify(t))),this.tokenData=t,this.emmitTokenReadyEvent(),(0,m.of)(this.tokenData)}refresh(){var t;return(null===(t=this.tokenData)||void 0===t?void 0:t.refresh_token)?this.http.post(E,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:this.tokenData.refresh_token}).pipe((0,A.K)(o=>(console.error(o),(0,m.of)(null))),(0,v.w)(o=>this.setTokenData(o))):(0,m.of)(null)}getAuthorizationLink(){return this.codeChallenge$.pipe((0,h.U)(t=>{const o=S(16);localStorage.setItem(k,this.codeVerifier),localStorage.setItem(w,o);const i=new URL("https://accounts.google.com/o/oauth2/v2/auth");i.searchParams.append("client_id",this.configuration.client_id),i.searchParams.append("redirect_uri",this.configuration.redirect_uri),i.searchParams.append("response_type","code");const s=this.configuration.scopes.join(" ");i.searchParams.append("scope",s),i.searchParams.append("code_challenge",t),i.searchParams.append("code_challenge_method","S256");const a=new URLSearchParams;return a.append("internal_redirect_uri",this.router.url),a.append("security_token",o),i.searchParams.append("state",a.toString()),i.searchParams.append("prompt","consent"),i.searchParams.append("access_type","offline"),i.toString()}))}requestAccessToken(t,o){const i=localStorage.getItem(w);return i&&i===o?this.http.post(E,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:t,code_verifier:localStorage.getItem(k),grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe((0,A.K)(s=>(console.error(s),(0,m.of)(null))),(0,h.U)(s=>this.setTokenData(s)),(0,h.U)(s=>!!s)):(0,m.of)(!1)}getAccessToken(){if(this.tokenData){const t=(new Date).getTime();return this.tokenData.expires<t?this.refresh().pipe((0,h.U)(o=>o?o.access_token:null)):(0,m.of)(this.tokenData.access_token)}return(0,m.of)(null)}getAuthorizationHeader(){return this.getAccessToken().pipe((0,h.U)(t=>{var o;return t?`${null===(o=this.tokenData)||void 0===o?void 0:o.token_type} ${t}`:null}))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(T.xZ),e.LFG(Z.eN),e.LFG(f.F0))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const U="https://www.googleapis.com/calendar/v3/calendars/primary/events";let x=(()=>{class n{constructor(t,o){this.tokenService=t,this.http=o}getAll(t){const o=Object.assign({},t);return this.tokenService.getAuthorizationHeader().pipe((0,v.w)(i=>i?this.http.get(U,{headers:{Authorization:i},params:o}):(0,m.of)(null)),(0,h.U)(i=>(0,T.Qh)(i)))}create(t){return this.tokenService.getAuthorizationHeader().pipe((0,v.w)(o=>o?this.http.post(U,t,{headers:{Authorization:o}}):(0,m.of)(null)),(0,h.U)(o=>(0,T.RC)(o)))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(y),e.LFG(Z.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var c=l(3075);let K=(()=>{class n{constructor(t){this.fb=t,this.onTouched=()=>{},this.subscriptons=[]}ngOnInit(){this.formGroup=this.fb.group({summary:[null,[c.kI.required]],start:this.fb.group({dateTime:[null,[c.kI.required]]}),end:this.fb.group({dateTime:[null,[c.kI.required]]})}),this.valueChanges$=this.formGroup.valueChanges.pipe((0,h.U)(t=>{var o,i;return(null===(o=t.start)||void 0===o?void 0:o.dateTime)&&(t.start.dateTime=new Date(t.start.dateTime).toISOString()),(null===(i=t.end)||void 0===i?void 0:i.dateTime)&&(t.end.dateTime=new Date(t.end.dateTime).toISOString()),t}))}ngOnDestroy(){this.subscriptons.forEach(t=>t.unsubscribe())}writeValue(t){t&&this.formGroup.setValue(t,{emitEvent:!1})}registerOnChange(t){const o=this.valueChanges$.subscribe(t);this.subscriptons.push(o)}registerOnTouched(t){this.onTouched=t}setDisabledState(t){t?this.formGroup.disable():this.formGroup.enable()}validate(t){if(!this.formGroup.invalid)return null;let o=Object.assign({},this.formGroup.errors);return["summary","start.dateTime","end.dateTime"].forEach(i=>{const s=this.formGroup.get(i);s.errors&&(o[i]=s.errors)}),o}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(c.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-events-control"]],features:[e._Bn([{provide:c.JU,useExisting:n,multi:!0},{provide:c.Cf,useExisting:n,multi:!0}])],decls:23,vars:1,consts:[[1,"mb-3"],[3,"formGroup"],[1,"row","mb-3"],[1,"col-lg-2","d-flex","justify-content-between"],[1,"col-lg-10"],["type","text","formControlName","summary",1,"form-control",3,"blur"],[1,"col-lg-5"],["formGroupName","start"],["type","datetime-local","formControlName","dateTime",1,"form-control",3,"blur"],["formGroupName","end"]],template:function(t,o){1&t&&(e.TgZ(0,"h4",0),e._uU(1,"Create Event"),e.qZA(),e.ynx(2,1),e.TgZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"label"),e._uU(6,"Summary"),e.qZA(),e.TgZ(7,"span"),e._uU(8,"::"),e.qZA(),e.qZA(),e.TgZ(9,"div",4),e.TgZ(10,"input",5),e.NdJ("blur",function(){return o.onTouched()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"div",2),e.TgZ(12,"div",3),e.TgZ(13,"label"),e._uU(14,"Time Range"),e.qZA(),e.TgZ(15,"span"),e._uU(16,"::"),e.qZA(),e.qZA(),e.TgZ(17,"div",6),e.ynx(18,7),e.TgZ(19,"input",8),e.NdJ("blur",function(){return o.onTouched()}),e.qZA(),e.BQk(),e.qZA(),e.TgZ(20,"div",6),e.ynx(21,9),e.TgZ(22,"input",8),e.NdJ("blur",function(){return o.onTouched()}),e.qZA(),e.BQk(),e.qZA(),e.qZA(),e.BQk()),2&t&&(e.xp6(2),e.Q6J("formGroup",o.formGroup))},directives:[c.JL,c.sg,c.Fj,c.JJ,c.u,c.x0],styles:[""]}),n})();var d=l(6964);let W=(()=>{class n{constructor(t){this.fb=t,this.data=null,this.dataChange=new e.vpe,this.cancel=new e.vpe,this.errorMessage=null}ngOnInit(){this.formGroup=this.fb.group({eventResource:[this.data,[c.kI.required]]})}onSubmit(){if(this.errorMessage=null,this.formGroup.invalid)this.errorMessage="Invalid form data!!!";else{const t=this.formGroup.get("eventResource");this.dataChange.emit(t.value)}}onCancel(){this.cancel.emit()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(c.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-events-form"]],inputs:{data:"data"},outputs:{dataChange:"dataChange",cancel:"cancel"},decls:15,vars:2,consts:[[2,"width","fit-content",3,"formGroup","ngSubmit"],["formControlName","eventResource"],[1,"row","row-cols-auto","d-flex","justify-content-center"],[1,"col"],["type","submit",1,"btn","btn-success","d-flex","justify-content-center"],["type","submit",1,"btn","btn-danger","d-flex","justify-content-center",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e._UZ(1,"app-google-events-control",1),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"div",2),e.TgZ(5,"div",3),e.TgZ(6,"button",4),e.TgZ(7,"mat-icon"),e._uU(8,"save "),e.qZA(),e._uU(9," Save "),e.qZA(),e.qZA(),e.TgZ(10,"div",3),e.TgZ(11,"button",5),e.NdJ("click",function(){return o.onCancel()}),e.TgZ(12,"mat-icon"),e._uU(13,"cancel "),e.qZA(),e._uU(14," Cancel "),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.Q6J("formGroup",o.formGroup),e.xp6(3),e.Oqu(o.errorMessage))},directives:[c._Y,c.JL,c.sg,K,c.JJ,c.u,d.Hw],styles:[""]}),n})(),V=(()=>{class n{constructor(t){this.service=t}ngOnInit(){}onChange(t){var o;null===(o=this.service.create(t))||void 0===o||o.subscribe(i=>{history.back()})}onCancel(){history.back()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-event-create-page"]],decls:1,vars:0,consts:[[3,"dataChange","cancel"]],template:function(t,o){1&t&&(e.TgZ(0,"app-google-events-form",0),e.NdJ("dataChange",function(s){return o.onChange(s)})("cancel",function(){return o.onCancel()}),e.qZA())},directives:[W],styles:[""]}),n})(),ee=(()=>{class n{constructor(t,o,i){this.tokenService=t,this.route=o,this.router=i,this.errorMessage=null}ngOnInit(){const t=this.route.snapshot.queryParams,o=new URLSearchParams(t.state);t.error?this.errorMessage=t.error:t.code&&this.tokenService.requestAccessToken(t.code,o.get("security_token")).subscribe(i=>{i?this.router.navigateByUrl(o.get("internal_redirect_uri")):this.errorMessage="Unknow Error !!!"})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(y),e.Y36(f.gz),e.Y36(f.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-authorization-page"]],decls:2,vars:0,template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"google-authorization-page works!"),e.qZA())},styles:[""]}),n})(),ne=(()=>{class n{constructor(t,o){this.tokenService=t,this.http=o}getAll(){return this.tokenService.getAuthorizationHeader().pipe((0,v.w)(t=>t?(console.log(t),this.http.get("https://people.googleapis.com/v1/people/me/connections?personFields=addresses",{headers:{Authorization:t}})):(0,m.of)(null)),(0,h.U)(t=>(0,T._8)(t)))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(y),e.LFG(Z.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function oe(n,r){if(1&n&&(e.TgZ(0,"a"),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.qZA()),2&n){const t=r.$implicit;e.xp6(2),e.Oqu(t)}}function re(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,oe,3,1,"a",2),e.qZA()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("ngForOf",t.totalItems)}}function ie(n,r){1&n&&(e.TgZ(0,"div"),e._uU(1,"Loading..."),e.qZA())}let se=(()=>{class n{constructor(t){this.service=t}ngOnInit(){this.data$=this.service.getAll()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ne))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-contacts-list-page"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],[4,"ngFor","ngForOf"]],template:function(t,o){if(1&t&&(e.YNc(0,re,2,1,"div",0),e.ALo(1,"async"),e.YNc(2,ie,2,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(3);e.Q6J("ngIf",e.lcZ(1,2,o.data$))("ngIfElse",i)}},directives:[g.O5,g.sg],pipes:[g.Ov],styles:[""]}),n})();function ae(n,r){if(1&n&&(e.TgZ(0,"a",3),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"small"),e._uU(4),e.qZA(),e.qZA()),2&n){const t=r.$implicit;e.Q6J("href",t.htmlLink,e.LSH),e.xp6(2),e.Oqu(t.summary),e.xp6(2),e.AsE("",t.start.dateTime," - ",t.end.dateTime,"")}}function le(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,ae,5,4,"a",2),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.data.items)}}function ce(n,r){1&n&&(e.TgZ(0,"div"),e._uU(1,"loading..."),e.qZA())}let ue=(()=>{class n{constructor(){this.data=null}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-events-list"]],inputs:{data:"data"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],["target","_blank","class","list-group-item list-group-item-action",3,"href",4,"ngFor","ngForOf"],["target","_blank",1,"list-group-item","list-group-item-action",3,"href"]],template:function(t,o){if(1&t&&(e.YNc(0,le,2,1,"div",0),e.YNc(1,ce,2,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",o.data)("ngIfElse",i)}},directives:[g.O5,g.sg],styles:[""]}),n})(),ge=(()=>{class n{constructor(t){this.service=t}ngOnInit(){const t=new Date;this.data$=this.service.getAll({singleEvents:!0,orderBy:"startTime",timeMin:t.toISOString()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google-evevts-list-page"]],decls:7,vars:3,consts:[["routerLink","create",1,"btn","btn-outline-dark","mb-3","btn-create"],[3,"data"]],template:function(t,o){1&t&&(e.TgZ(0,"div"),e.TgZ(1,"a",0),e.TgZ(2,"mat-icon"),e._uU(3,"event"),e.qZA(),e._uU(4," Create Event"),e.qZA(),e.qZA(),e._UZ(5,"app-google-events-list",1),e.ALo(6,"async")),2&t&&(e.xp6(5),e.Q6J("data",e.lcZ(6,1,o.data$)))},directives:[f.yS,d.Hw,ue],pipes:[g.Ov],styles:[""]}),n})();function pe(n,r){if(1&n&&(e.TgZ(0,"div"),e.TgZ(1,"button",10),e.TgZ(2,"a",11),e.ALo(3,"async"),e.TgZ(4,"mat-icon"),e._uU(5,"login "),e.qZA(),e._uU(6," Google"),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("href",e.lcZ(3,1,t.authorizationLinks$),e.LSH)}}function me(n,r){1&n&&e._UZ(0,"router-outlet")}const he=[{path:"authorization",component:ee},{path:"",component:(()=>{class n{constructor(t){this.TokenService=t}ngOnInit(){this.tokenReady$=this.TokenService.tokenReady$,this.authorizationLinks$=this.TokenService.getAuthorizationLink()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-google"]],decls:16,vars:5,consts:[[1,"cmp","mb-3"],[1,"mb-3"],[1,"row"],[1,"cmp-nav"],[1,"nav"],[1,"nav-item"],["routerLink","./events",1,"nav-link","btn","btn-link","me-3"],["routerLink","./contacts",1,"nav-link","btn","btn-link","me-3"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"btn","btn-login"],[3,"href"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"h2",1),e._uU(2,"Google"),e.qZA(),e.TgZ(3,"div",2),e.TgZ(4,"nav",3),e.TgZ(5,"ul",4),e.TgZ(6,"li",5),e.TgZ(7,"a",6),e._uU(8,"Events"),e.qZA(),e.qZA(),e.TgZ(9,"li",5),e.TgZ(10,"a",7),e._uU(11,"Contacts"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.ynx(12,8),e.ALo(13,"async"),e.YNc(14,pe,7,3,"div",9),e.YNc(15,me,1,0,"router-outlet",9),e.BQk()),2&t&&(e.xp6(12),e.Q6J("ngSwitch",e.lcZ(13,3,o.tokenReady$)),e.xp6(2),e.Q6J("ngSwitchCase",!1),e.xp6(1),e.Q6J("ngSwitchCase",!0))},directives:[f.yS,g.RF,g.n9,d.Hw,f.lC],pipes:[g.Ov],styles:[""]}),n})(),children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:ge},{path:"events/create",component:V},{path:"",redirectTo:"contacts",pathMatch:"full"},{path:"contacts",component:se}]}];let fe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[f.Bz.forChild(he)],f.Bz]}),n})(),de=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez,c.UX,d.Ps]]}),n})(),ve=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez,fe,d.Ps,de]]}),n})()}}]);