"use strict";(self.webpackChunkmy_ng3=self.webpackChunkmy_ng3||[]).push([[518],{4518:(re,y,c)=>{c.r(y),c.d(y,{GoogleModule:()=>ne});var h=c(9808),g=c(4354),n=c(7587),Z=c(1135),x=c(4671),w=c(4482),P=c(5403);function U(e,r){return e===r}var R=c(2076),f=c(4004),I=c(7579),$=c(6063);class b extends I.x{constructor(r=1/0,t=1/0,o=$.l){super(),this._bufferSize=r,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,r),this._windowTime=Math.max(1,t)}next(r){const{isStopped:t,_buffer:o,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:a}=this;t||(o.push(r),!i&&o.push(s.now()+a)),this._trimBuffer(),super.next(r)}_subscribe(r){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(r),{_infiniteTimeWindow:o,_buffer:i}=this,s=i.slice();for(let a=0;a<s.length&&!r.closed;a+=o?1:2)r.next(s[a]);return this._checkFinalizedStatuses(r),t}_trimBuffer(){const{_bufferSize:r,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:i}=this,s=(i?1:2)*r;if(r<1/0&&s<o.length&&o.splice(0,o.length-s),!i){const a=t.now();let l=0;for(let u=1;u<o.length&&o[u]<=a;u+=2)l=u;l&&o.splice(0,l+1)}}}var E=c(3099),p=c(9646),T=c(262),S=c(3900),F=c(2923);function k(e,r,t,o,i,s,a){try{var l=e[s](a),u=l.value}catch(oe){return void t(oe)}l.done?r(u):Promise.resolve(u).then(o,i)}function M(e){return function(){var r=this,t=arguments;return new Promise(function(o,i){var s=e.apply(r,t);function a(u){k(s,o,i,a,l,"next",u)}function l(u){k(s,o,i,a,l,"throw",u)}a(void 0)})}}function d(){return(d=M(function*(e){const t=(new TextEncoder).encode(e);return crypto.subtle.digest("SHA-256",t)})).apply(this,arguments)}var A=c(520);const m="google-token",G="https://oauth2.googleapis.com/token";let v=(()=>{class e{constructor(t,o,i){this.configuration=t,this.http=o,this.router=i,this.tokenReadySubject=new Z.X(null),this.tokenData=null,this.tokenReady$=this.tokenReadySubject.asObservable().pipe(function L(e,r=x.y){return e=null!=e?e:U,(0,w.e)((t,o)=>{let i,s=!0;t.subscribe(new P.Q(o,a=>{const l=r(a);(s||!e(i,l))&&(s=!1,i=l,o.next(a))}))})}());const s=localStorage.getItem(m);s&&(this.tokenData=JSON.parse(s)),this.codeVerifier=function _(e){const r=new Uint32Array(e/2);return crypto.getRandomValues(r),Array.from(r,t=>("0"+t.toString(16)).slice(-2)).join("")}(56),this.codeChallenge$=(0,R.D)(function Y(e){return d.apply(this,arguments)}(this.codeVerifier)).pipe((0,f.U)(a=>function D(e){return function j(e){let r="",t=new Uint8Array(e),o=t.byteLength;for(var i=0;i<o;i++)r+=String.fromCharCode(t[i]);return btoa(r)}(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(a)),function z(e,r,t){var o,i;let s,a=!1;return e&&"object"==typeof e?(s=null!==(o=e.bufferSize)&&void 0!==o?o:1/0,r=null!==(i=e.windowTime)&&void 0!==i?i:1/0,a=!!e.refCount,t=e.scheduler):s=null!=e?e:1/0,(0,E.B)({connector:()=>new b(s,r,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}(1)),this.getAccessToken().subscribe(()=>this.emmitTokenReadyEvent())}emmitTokenReadyEvent(){this.tokenReadySubject.next(!!this.tokenData)}setTokenData(t){var o;return null===t?localStorage.removeItem(m):(!t.refresh_token&&(null===(o=this.tokenData)||void 0===o?void 0:o.refresh_token)&&(t.refresh_token=this.tokenData.refresh_token),t.expires||(t.expires=(new Date).getTime()+1e3*(t.expires_in-10)),localStorage.setItem(m,JSON.stringify(t))),this.tokenData=t,this.emmitTokenReadyEvent(),(0,p.of)(this.tokenData)}refresh(){var t;return(null===(t=this.tokenData)||void 0===t?void 0:t.refresh_token)?this.http.post(G,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:this.tokenData.refresh_token}).pipe((0,T.K)(o=>(console.error(o),(0,p.of)(null))),(0,S.w)(o=>this.setTokenData(o))):(0,p.of)(null)}getAuthorizationLink(){return this.codeChallenge$.pipe((0,f.U)(t=>{const o=new URL("https://accounts.google.com/o/oauth2/v2/auth");o.searchParams.append("client_id",this.configuration.client_id),o.searchParams.append("redirect_uri",this.configuration.redirect_uri),o.searchParams.append("response_type","code");const i=this.configuration.scopes.join(" ");o.searchParams.append("scope",i),o.searchParams.append("code_challenge",""),o.searchParams.append("code_challenge_method","S256");const s=new URLSearchParams;return s.append("internal_redirect_uri",this.router.url),o.searchParams.append("state",s.toString()),o.searchParams.append("prompt","consent"),o.searchParams.append("access_type","offline"),o.toString()}))}requestAccessToken(t){return this.http.post(G,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:t,code_verifier:localStorage.getItem("google-code-verifier"),grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe((0,T.K)(o=>(console.error(o),(0,p.of)(null))),(0,f.U)(o=>this.setTokenData(o)),(0,f.U)(o=>!!o))}getAccessToken(){if(this.tokenData){const t=(new Date).getTime();return this.tokenData.expires<t?this.refresh().pipe((0,f.U)(o=>o?o.access_token:null)):(0,p.of)(this.tokenData.access_token)}return(0,p.of)(null)}getAuthorizationHeader(){return this.getAccessToken().pipe((0,f.U)(t=>{var o;return t?`${null===(o=this.tokenData)||void 0===o?void 0:o.token_type} ${t}`:null}))}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(F.x),n.LFG(A.eN),n.LFG(g.F0))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),O=(()=>{class e{constructor(t,o,i){this.tokenService=t,this.route=o,this.router=i,this.errorMessage=null}ngOnInit(){const t=this.route.snapshot.queryParams;t.error?this.errorMessage=t.error:t.code&&this.tokenService.requestAccessToken(t.code).subscribe(o=>{if(o){const i=new URLSearchParams(t.state);this.router.navigateByUrl(i.get("internal_redirect_uri"))}else this.errorMessage="Unknow Error !!!"})}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v),n.Y36(g.gz),n.Y36(g.F0))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google-authorization-page"]],decls:2,vars:0,template:function(t,o){1&t&&(n.TgZ(0,"p"),n._uU(1,"google-authorization-page works!"),n.qZA())},styles:[""]}),e})(),K=(()=>{class e{constructor(t,o){this.tokenService=t,this.http=o}getAll(){return this.tokenService.getAuthorizationHeader().pipe((0,S.w)(t=>t?this.http.get("https://www.googleapis.com/calendar/v3/calendars/primary/events",{headers:{Authorization:t}}):(0,p.of)(null)))}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(v),n.LFG(A.eN))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function W(e,r){if(1&e&&(n.TgZ(0,"div"),n.TgZ(1,"code"),n._uU(2),n.ALo(3,"json"),n.qZA(),n.qZA()),2&e){const t=r.ngIf;n.xp6(2),n.Oqu(n.lcZ(3,1,t))}}function H(e,r){1&e&&(n.TgZ(0,"div"),n._uU(1,"loading..."),n.qZA())}let X=(()=>{class e{constructor(t){this.service=t}ngOnInit(){this.data$=this.service.getAll()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(K))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google-evevts-list-page"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""]],template:function(t,o){if(1&t&&(n.YNc(0,W,4,3,"div",0),n.ALo(1,"async"),n.YNc(2,H,2,0,"ng-template",null,1,n.W1O)),2&t){const i=n.MAs(3);n.Q6J("ngIf",n.lcZ(1,2,o.data$))("ngIfElse",i)}},directives:[h.O5],pipes:[h.Ov,h.Ts],styles:[""]}),e})();var C=c(6964);function V(e,r){if(1&e&&(n.TgZ(0,"div"),n.TgZ(1,"button",9),n.TgZ(2,"a",10),n.ALo(3,"async"),n.TgZ(4,"mat-icon"),n._uU(5,"login "),n.qZA(),n._uU(6," Google"),n.qZA(),n.qZA(),n.qZA()),2&e){const t=n.oxw();n.xp6(2),n.Q6J("href",n.lcZ(3,1,t.authorizationLinks$),n.LSH)}}function q(e,r){1&e&&n._UZ(0,"router-outlet")}const ee=[{path:"authorization",component:O},{path:"",component:(()=>{class e{constructor(t){this.TokenService=t}ngOnInit(){this.tokenReady$=this.TokenService.tokenReady$,this.authorizationLinks$=this.TokenService.getAuthorizationLink()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google"]],decls:13,vars:5,consts:[[1,"cmp","mb-3"],[1,"mb-3"],[1,"row"],[1,"cmp-nav"],[1,"nav"],[1,"nav-item"],["routerLink","./events",1,"nav-link","btn","btn-link","me-3"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"btn","btn-login"],[3,"href"]],template:function(t,o){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"h2",1),n._uU(2,"Google"),n.qZA(),n.TgZ(3,"div",2),n.TgZ(4,"nav",3),n.TgZ(5,"ul",4),n.TgZ(6,"li",5),n.TgZ(7,"a",6),n._uU(8,"Events"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.ynx(9,7),n.ALo(10,"async"),n.YNc(11,V,7,3,"div",8),n.YNc(12,q,1,0,"router-outlet",8),n.BQk()),2&t&&(n.xp6(9),n.Q6J("ngSwitch",n.lcZ(10,3,o.tokenReady$)),n.xp6(2),n.Q6J("ngSwitchCase",!1),n.xp6(1),n.Q6J("ngSwitchCase",!0))},directives:[g.yS,h.RF,h.n9,C.Hw,g.lC],pipes:[h.Ov],styles:[""]}),e})(),children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:X}]}];let te=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[g.Bz.forChild(ee)],g.Bz]}),e})(),ne=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[h.ez,te,C.Ps]]}),e})()}}]);